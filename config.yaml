# Ductile Configuration
# See docs/ARCHITECTURE.md ยง11 for full reference

service:
  name: ductile
  tick_interval: 60s           # Scheduler heartbeat
  log_level: info              # debug, info, warn, error
  log_format: json             # json
  dedupe_ttl: 24h              # Deduplication window
  job_log_retention: 168h      # 7 days

state:
  path: ./ductile.db          # SQLite database path (PID lock derived from this)

# API Server: HTTP endpoints for external triggers (Sprint 2)
api:
  enabled: false               # Enable/disable API server
  listen: "localhost:8080"     # Listen address
  auth:
    # Legacy single token (admin/full access):
    # api_key: ${API_KEY}
    #
    # Scoped tokens:
    tokens:
      - token: ${DUCTILE_TOKEN_ADMIN}
        scopes: ["*"]

plugin_roots:
  - ./plugins                  # Native in-repo plugin directory

plugins:
  echo:
    enabled: true
    schedule:
      every: 5m                # Supported: 5m, 15m, 30m, hourly, 2h, 6h, daily, weekly, monthly
      jitter: 30s              # Randomization to avoid thundering herd
    timeout: 30s
    max_attempts: 3
    circuit_breaker:
      threshold: 3             # Consecutive failures before blocking scheduler
      reset_after: 5m
    config:
      # Plugin-specific config goes here
      # Example: message: "Hello from echo plugin"

# Routes: event-driven plugin chaining (not in MVP)
# routes:
#   - from: plugin_a
#     event_type: data_ready
#     to: plugin_b

# Webhooks: HTTP listener endpoints (not in MVP)
# webhooks:
#   github:
#     path: /webhook/github
#     secret: ${GITHUB_WEBHOOK_SECRET}
#     route_to: github_handler
